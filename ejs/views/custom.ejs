<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Sandwich</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            padding-left: 50px;
        }
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ï‡πâ Navbar */
        .menu-container {
            margin-top: 80px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å Navbar */
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î topping box */
        .topping-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            margin-bottom: 15px;
            background-color: white;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤ */
            transition: all 0.3s ease-in-out;
        }
        .topping-item:hover {
            transform: scale(1.02); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover */
            box-shadow: 3px 3px 12px rgba(0, 0, 0, 0.2);
        }
        .topping-item img {
            width: 90px;
            height: 90px;
            border-radius: 8px;
            margin-right: 15px;
        }
        .topping-item .details {
            flex-grow: 1;
        }
        .topping-item .quantity-controls {
            display: flex;
            align-items: center;
        }
    
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° + ‡πÅ‡∏•‡∏∞ - */
        .quantity-controls .btn {
            width: 35px;
            height: 35px;
            font-size: 20px;
            border-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quantity-controls .btn:hover {
            background-color: #2E8B57; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            color: white;
            border-color: #2E8B57;
        }
        .quantity-controls span {
            font-size: 18px;
            font-weight: bold;
            width: 30px;
            text-align: center;
        }
    
        /* ‡∏õ‡∏£‡∏±‡∏ö UI ‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Meat, Vegetables, Sauces) */
        .category-box {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        .category-box h4 {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        
    
        /* ‡∏õ‡∏£‡∏±‡∏ö UI ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        .cart-box {
            background-color: #f8f9fa; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á */
            padding: 15px;
            border-radius: 12px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            max-width: 400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 500px;
        }

        .cart-header {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

    
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ */
        #confirmOrder {
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            padding: 12px;
            border-radius: 8px;
        }
        #confirmOrder:hover {
            background-color: #1E7E34;
        }

         /* Responsive */
        @media (max-width: 768px) {
            .cart-box {
                max-width: 100%;
                position: relative;
                margin-top: 20px;
            }

            .cart-items-container {
                max-height: 300px;
            }
            .menu-container {
                margin-top: 25px;
            }
        }
    </style>
    
</head>
<body id="custom-page">
    
    <%- include('partials/navbar') %>

        <div class="row mt-5 mb-5">
            <div class="col-lg-8">
                <h3>Bacon</h3>
                <p class="text-muted">Enjoy with medium crispy thin pizza with classic topping, spaghetti 129.- and chicken nuggets 6 pcs.</p>
                <img src="/img/promote.png" alt="Custom Sandwich" class="img-fluid rounded">
                <div class="d-flex align-items-center gap-3 mt-3">
                    <label class="form-label mb-0">Size:</label>
                    <div class="btn-group">
                        <input type="radio" class="btn-check" name="size" id="small" autocomplete="off" checked>
                        <label class="btn btn-outline-success" for="small">Small</label>
                        <input type="radio" class="btn-check" name="size" id="medium" autocomplete="off">
                        <label class="btn btn-outline-success" for="medium">Medieum</label>
                        <input type="radio" class="btn-check" name="size" id="large" autocomplete="off">
                        <label class="btn btn-outline-success" for="large">Large</label>
                    </div>
                    <label class="form-label mb-0">Bread:</label>
                    <select class="form-select" style="width: 150px;">
                        <option>Flatbread</option>
                        <option>Hearty Italian</option>
                        <option>Honey Oat</option>
                        <option>Wheat Bread</option>
                        <option>Italian</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <h3>Add topping</h3>
            <div class="col-lg-8 mt-3">
                <!-- Meat Category -->
                <div class="category-box">
                    <h4 class="mb-3">Meat</h4>
                    <div class="row">
                        <% meats.forEach(meats => { %>
                        <div class="col-md-6 mb-3">
                            <div class="topping-item">
                                <img src="<%= meats.img %>">
                                <div class="details">
                                    <h5 class="mb-1"><%= meats.name %></h5>
                                    <p class="text-success fw-bold"><%= meats.price %></p>
                                </div>
                                <div class="quantity-controls">
                                    <button class="btn btn-sm btn-outline-secondary">-</button>
                                    <span class="mx-2">0</span>
                                    <button class="btn btn-sm btn-outline-secondary">+</button>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>

                <!-- Vegetables Category -->
                <div class="category-box mt-4">
                    <h4 class="mb-3">Vegetables</h4>
                    <div class="row">
                        <% vegetables.forEach(vegetables => { %>
                        <div class="col-md-6 mb-3">
                            <div class="topping-item">
                                <img src="<%= vegetables.img %>">
                                <div class="details">
                                    <h5 class="mb-1"><%= vegetables.name %></h5>
                                    <p class="text-success fw-bold"><%= vegetables.price %></p>
                                </div>
                                <div class="quantity-controls">
                                    <button class="btn btn-sm btn-outline-secondary">-</button>
                                    <span class="mx-2">0</span>
                                    <button class="btn btn-sm btn-outline-secondary">+</button>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>

                <!-- Sauces Category -->
                <div class="category-box mt-4">
                    <h4 class="mb-3">Sauces</h4>
                    <div class="row">
                        <% sauces.forEach(sauces => { %>
                        <div class="col-md-6 mb-3">
                            <div class="topping-item">
                                <img src="<%= sauces.img %>">
                                <div class="details">
                                    <h5 class="mb-1"><%= sauces.name %></h5>
                                    <p class="text-success fw-bold"><%= sauces.price %></p>
                                </div>
                                <div class="quantity-controls">
                                    <button class="btn btn-sm btn-outline-secondary">-</button>
                                    <span class="mx-2">0</span>
                                    <button class="btn btn-sm btn-outline-secondary">+</button>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>
            </div>
            
            <!-- Cart Box -->
            <div class="col-lg-4">
                <div class="cart-box bg-light p-3 rounded shadow-sm">
                    <p>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤...</p>
                    <button id="confirmOrder" class="btn btn-success">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('/get-toppings')
            .then(response => response.json())
            .then(data => {
                console.log("üìå Data Loaded:", data);

                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏à‡∏≤‡∏Å HTML
                let categories = {
                    meat: document.querySelector(".category-box[data-category='meat'] .row"),
                    vegetable: document.querySelector(".category-box[data-category='vegetable'] .row"),
                    sauce: document.querySelector(".category-box[data-category='sauce'] .row"),
                };

                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                Object.values(categories).forEach(container => container.innerHTML = "");

                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                data.forEach(topping => {
                    let itemHTML = `
                        <div class="col-md-6 mb-3">
                            <div class="topping-item">
                                <img src="${topping.img}" alt="${topping.name}">
                                <div class="details">
                                    <h5 class="mb-1">${topping.name}</h5>
                                    <p class="text-success fw-bold">${topping.price} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                                <div class="quantity-controls">
                                    <button class="btn btn-sm btn-outline-secondary" data-action="decrease" data-name="${topping.name}">-</button>
                                    <span class="mx-2" id="quantity-${topping.name}">0</span>
                                    <button class="btn btn-sm btn-outline-secondary" data-action="increase" data-name="${topping.name}">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                    categories[topping.category]?.insertAdjacentHTML("beforeend", itemHTML);
                });
            })
            .catch(error => console.error("‚ùå Error fetching toppings:", error));
        });


        document.addEventListener("DOMContentLoaded", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || []; // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏≤‡∏Å localStorage

            function updateCartDisplay() {
                let cartBox = document.querySelector(".cart-box p");
                if (cart.length === 0) {
                    cartBox.innerHTML = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤";
                } else {
                    cartBox.innerHTML = cart.map(item => `${item.name} x ${item.quantity} (${item.price * item.quantity} ‡∏ö‡∏≤‡∏ó)`).join("<br>");
                }
            }

                document.body.addEventListener("click", function (event) {
                    if (event.target.matches(".btn-outline-secondary")) {
                        let button = event.target;
                        let itemElement = button.closest(".topping-item");
                        let name = itemElement.querySelector("h5").textContent;
                        let price = parseFloat(itemElement.querySelector("p").textContent);
                        let quantityElement = itemElement.querySelector(".mx-2");

                        let itemIndex = cart.findIndex(item => item.name === name);
                        if (button.textContent === "+") {
                            if (itemIndex !== -1) {
                                cart[itemIndex].quantity += 1;
                            } else {
                                cart.push({ name, price, quantity: 1 });
                            }
                        } else if (button.textContent === "-") {
                            if (itemIndex !== -1 && cart[itemIndex].quantity > 0) {
                                cart[itemIndex].quantity -= 1;
                                if (cart[itemIndex].quantity === 0) {
                                    cart.splice(itemIndex, 1);
                                }
                            }
                        }
                        quantityElement.textContent = cart.find(item => item.name === name)?.quantity || 0;
                        localStorage.setItem("cart", JSON.stringify(cart));
                        updateCartDisplay();
                    }
                });

                updateCartDisplay(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            });

            document.getElementById("confirmOrder").addEventListener("click", function () {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                if (cart.length === 0) {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
                    return;
                }
                localStorage.setItem("cart", JSON.stringify(cart));
                window.location.href = "/checkout";
            });

    </script>
    

    <%- include('partials/footer') %>

</body>
</html>